--====================================================
-- ðŸ“º TITAN TIVI MAN HUB | BLOX FRUITS | RAYFIELD FINAL
-- Anti Kick â€¢ Safe Mode â€¢ Human Like
--====================================================

local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "ðŸ“º Titan Tivi Man Hub | Anti Kick",
    LoadingTitle = "Titan Tivi Man Hub",
    LoadingSubtitle = "Safe â€¢ Stable â€¢ Strong",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "TitanTiviMan",
        FileName = "FinalSafe"
    },
    KeySystem = false
})

-- SERVICES
local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local VIM = game:GetService("VirtualInputManager")
local LP = Players.LocalPlayer
local CommF = RS.Remotes.CommF_

-- STATE
local State = {
    AutoFarm = false,
    AutoQuest = true,
    AutoSkill = false,
    AutoDodge = false,
    Aim = false,
    AutoRaid = false,
    AutoAwaken = false,
    SafeMode = false,
    HumanDelay = true
}

-- BASIC
local function Char()
    return LP.Character or LP.CharacterAdded:Wait()
end
local function HRP()
    return Char():WaitForChild("HumanoidRootPart")
end

-- AUTO EQUIP COMBAT
local function EquipCombat()
    local hum = Char():FindFirstChildOfClass("Humanoid")
    if not hum then return end
    for _,tool in pairs(LP.Backpack:GetChildren()) do
        if tool:IsA("Tool") then
            local n = tool.Name:lower()
            if n:find("combat") or n:find("leg") or n:find("electric")
            or n:find("dragon") or n:find("godhuman") or n:find("karate") then
                hum:EquipTool(tool)
                break
            end
        end
    end
end

LP.CharacterAdded:Connect(function()
    task.wait(1)
    EquipCombat()
end)

-- ADMIN / PLAYER NEAR (SAFE MODE)
local function PlayerNear()
    for _,plr in pairs(Players:GetPlayers()) do
        if plr ~= LP and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            if (plr.Character.HumanoidRootPart.Position - HRP().Position).Magnitude < 120 then
                return true
            end
        end
    end
    return false
end

task.spawn(function()
    while task.wait(1.5) do
        if State.SafeMode and PlayerNear() then
            for k in pairs(State) do
                if k ~= "SafeMode" then
                    State[k] = false
                end
            end
            Rayfield:Notify({
                Title = "SAFE MODE",
                Content = "CÃ³ ngÆ°á»i chÆ¡i gáº§n â€“ AutoFarm Ä‘Ã£ táº¯t",
                Duration = 4
            })
        end
    end
end)

-- QUEST
local function HasQuest()
    local gui = LP.PlayerGui:FindFirstChild("Main")
    return gui and gui:FindFirstChild("Quest") and gui.Quest.Visible
end

task.spawn(function()
    while task.wait(1) do
        if State.AutoFarm and State.AutoQuest and not HasQuest() then
            pcall(function()
                CommF:InvokeServer("StartQuest","BanditQuest1",1)
            end)
        end
    end
end)

-- TARGET
local function GetBoss()
    for _,v in pairs(workspace.Enemies:GetChildren()) do
        if v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0
        and v.Name:lower():find("boss") then
            return v
        end
    end
end

local function GetNPC()
    local best, dist = nil, math.huge
    for _,v in pairs(workspace.Enemies:GetChildren()) do
        if v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0
        and v:FindFirstChild("HumanoidRootPart")
        and not v.Name:lower():find("boss") then
            local d = (v.HumanoidRootPart.Position - HRP().Position).Magnitude
            if d < dist then
                dist = d
                best = v
            end
        end
    end
    return best
end

local function GetTarget()
    return GetBoss() or GetNPC()
end

-- AIR FARM (HUMAN LIKE)
task.spawn(function()
    while task.wait(0.15) do
        if State.AutoFarm then
            local t = GetTarget()
            if t and t:FindFirstChild("HumanoidRootPart") then
                if State.HumanDelay and math.random(1,10) <= 2 then
                    task.wait(math.random(2,4))
                end
                local angle = tick() % 6
                HRP().AssemblyLinearVelocity = Vector3.zero
                HRP().CFrame =
                    t.HumanoidRootPart.CFrame *
                    CFrame.new(
                        math.cos(angle)*6,
                        22 + math.random(-2,2),
                        math.sin(angle)*6
                    )
            end
        end
    end
end)

-- AUTO SKILL (NO M1)
local Skills = {Enum.KeyCode.Z,Enum.KeyCode.X,Enum.KeyCode.C,Enum.KeyCode.V,Enum.KeyCode.F}
local idx = 1
task.spawn(function()
    while task.wait(0.45) do
        if State.AutoSkill then
            local k = Skills[idx]
            idx = idx % #Skills + 1
            VIM:SendKeyEvent(true, k, false, game)
            task.wait(0.05)
            VIM:SendKeyEvent(false, k, false, game)
        end
    end
end)

-- AIM
RunService.RenderStepped:Connect(function()
    if State.Aim then
        local t = GetTarget()
        if t and t:FindFirstChild("Head") then
            workspace.CurrentCamera.CFrame =
                CFrame.new(workspace.CurrentCamera.CFrame.Position, t.Head.Position)
        end
    end
end)

-- AUTO DODGE (NOT 100%)
local DodgeCD = false
local LastHP = 0
task.spawn(function()
    while task.wait(0.12) do
        if not State.AutoDodge or not State.AutoFarm then continue end
        local hum = Char():FindFirstChild("Humanoid")
        if not hum then continue end
        if LastHP == 0 then LastHP = hum.Health end
        local drop = LastHP - hum.Health
        LastHP = hum.Health
        if drop > hum.MaxHealth * 0.08 and math.random(1,100) <= 70 and not DodgeCD then
            DodgeCD = true
            HRP().CFrame = HRP().CFrame * CFrame.new(
                math.random(-25,25),
                math.random(35,55),
                math.random(-15,-10)
            )
            task.wait(0.5)
            DodgeCD = false
        end
    end
end)

-- RAID
local RaidFruit = "Flame"
local RaidMethod = "Fruit"

task.spawn(function()
    while task.wait(2) do
        if State.AutoRaid then
            pcall(function()
                CommF:InvokeServer("RaidsNpc","Select",RaidFruit)
                CommF:InvokeServer("RaidsNpc","Start",RaidMethod)
            end)
        end
    end
end)

task.spawn(function()
    while task.wait(3) do
        if State.AutoAwaken then
            pcall(function()
                CommF:InvokeServer("Awakener","Awaken")
            end)
        end
    end
end)

-- TABS
local StartTab = Window:CreateTab("ðŸš€ Start")
local FarmTab = Window:CreateTab("âš›ï¸ Farm")
local CombatTab = Window:CreateTab("âš”ï¸ Combat")
local RaidTab = Window:CreateTab("ðŸ”¥ Raid")
local GuideTab = Window:CreateTab("ðŸ“˜ Guide")
local TutorialTab = Window:CreateTab("ðŸ“˜ Tutorial")

StartTab:CreateButton({
    Name = "START ALL (SAFE)",
    Callback = function()
        State.AutoFarm = true
        State.AutoSkill = true
        State.AutoDodge = true
        State.SafeMode = true
        EquipCombat()
    end
})

StartTab:CreateButton({
    Name = "ðŸ›‘ STOP ALL",
    Callback = function()
        for k in pairs(State) do State[k] = false end
    end
})

FarmTab:CreateToggle({Name="Auto Farm (Air)",CurrentValue=false,Callback=function(v)State.AutoFarm=v end})
CombatTab:CreateToggle({Name="Auto Skill (No M1)",CurrentValue=false,Callback=function(v)State.AutoSkill=v end})
CombatTab:CreateToggle({Name="Aim Lock",CurrentValue=false,Callback=function(v)State.Aim=v end})
CombatTab:CreateToggle({Name="Auto Dodge (Safe)",CurrentValue=false,Callback=function(v)State.AutoDodge=v end})
CombatTab:CreateToggle({Name="ðŸ›¡ï¸ Safe Mode (Anti Kick)",CurrentValue=false,Callback=function(v)State.SafeMode=v end})
CombatTab:CreateToggle({Name="ðŸ¤– Human Delay",CurrentValue=true,Callback=function(v)State.HumanDelay=v end})

RaidTab:CreateToggle({Name="Auto Raid",CurrentValue=false,Callback=function(v)State.AutoRaid=v end})
RaidTab:CreateDropdown({
    Name="Raid Fruit",
    Options={"Flame","Ice","Light","Magma","Dark","Buddha","Rumble"},
    CurrentOption="Flame",
    Callback=function(v)RaidFruit=v end
})
RaidTab:CreateDropdown({
    Name="Raid Method",
    Options={"Fruit","Money"},
    CurrentOption="Fruit",
    Callback=function(v)RaidMethod=v end
})
RaidTab:CreateToggle({Name="Auto Awaken",CurrentValue=false,Callback=function(v)State.AutoAwaken=v end})

GuideTab:CreateParagraph({
    Title="HÆ°á»›ng dáº«n sá»­ dá»¥ng",
    Content="PC: Nháº¥n Shift Ä‘á»ƒ hoáº¡t Ä‘á»™ng.\nMobile: Báº­t Shift Lock vÃ  nháº¥n 2 láº§n."
})
TutorialTab:CreateParagraph({
    Title="How to Use",
    Content="PC: Press Shift to activate.\nMobile: Enable Shift Lock and tap twice."
})

Rayfield:Notify({
    Title="Titan Tivi Man Hub",
    Content="Loaded | Anti Kick Enabled",
    Duration=4
})
