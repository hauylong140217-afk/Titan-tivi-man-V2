--====================================================
-- Titan Tivi Man Hub | Blox Fruits FINAL
-- Rayfield UI | Auto Farm + Boss Priority + Aimbot
--====================================================

-- Load Rayfield
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "ðŸ“º Titan Tivi Man Hub | Blox Fruits (FINAL)",
    LoadingTitle = "Titan Tivi Man Hub",
    LoadingSubtitle = "Rayfield Quantum Style",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "TitanTiviMan",
        FileName = "BloxFruitsFinal"
    }
})

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RS = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LP = Players.LocalPlayer
local Char = LP.Character or LP.CharacterAdded:Wait()
local HRP = Char:WaitForChild("HumanoidRootPart")
local Hum = Char:WaitForChild("Humanoid")
local Cam = workspace.CurrentCamera

LP.CharacterAdded:Connect(function(c)
    Char = c
    HRP = c:WaitForChild("HumanoidRootPart")
    Hum = c:WaitForChild("Humanoid")
end)

--================ STATE =================
local State = {
    AutoFarm = false,
    FlySpeed = 320,
    FastAttack = true,
    Aimbot = false,
    FOV = 250
}

--================ UTILS =================
local function TweenTo(cf)
    local dist = (HRP.Position - cf.Position).Magnitude
    local t = dist / State.FlySpeed
    local tw = TweenService:Create(
        HRP,
        TweenInfo.new(t, Enum.EasingStyle.Linear),
        {CFrame = cf}
    )
    tw:Play()
    tw.Completed:Wait()
end

local function EquipWeapon()
    for _,v in pairs(LP.Backpack:GetChildren()) do
        if v:IsA("Tool") then
            Hum:EquipTool(v)
            return
        end
    end
end

local function Click()
    pcall(function() mouse1click() end)
end

local function FindEnemy(name)
    for _,m in pairs(workspace.Enemies:GetChildren()) do
        if m.Name == name and m:FindFirstChild("Humanoid")
        and m.Humanoid.Health > 0 then
            return m
        end
    end
end

local function WaitEnemy(name)
    for i = 1, 80 do
        local m = FindEnemy(name)
        if m then return m end
        task.wait(0.4)
    end
end

--================ QUEST TABLE (Gá»ŒN + á»”N Äá»ŠNH) =================
local QuestTable = {
    {Min=1,Max=700,Quest="BanditQuest1",ID=1,Mob="Bandit",NPC=CFrame.new(1061,16,1547)},
    {Min=700,Max=1500,Quest="Area1Quest",ID=1,Mob="Raider",NPC=CFrame.new(-424,73,1837)},
    {Min=1500,Max=2550,Quest="HauntedQuest1",ID=1,Mob="Reborn Skeleton",NPC=CFrame.new(-9515,172,6071)}
}

local function GetQuest()
    local lv = LP.Data.Level.Value
    for _,q in pairs(QuestTable) do
        if lv >= q.Min and lv < q.Max then
            return q
        end
    end
end

--================ BOSS PRIORITY =================
local BossTable = {
    {Quest="SkyBossQuest",ID=1,NPC=CFrame.new(-7923,5545,-636),Boss="Thunder God"},
    {Quest="TideKeeperQuest",ID=1,NPC=CFrame.new(-3041,238,2136),Boss="Tide Keeper"}
}

local function GetAliveBoss()
    for _,b in pairs(BossTable) do
        if FindEnemy(b.Boss) then
            return b
        end
    end
end

--================ AUTO FARM CORE =================
task.spawn(function()
    while task.wait() do
        if not State.AutoFarm then continue end

        -- Æ¯U TIÃŠN BOSS
        local boss = GetAliveBoss()
        if boss then
            TweenTo(boss.NPC)
            task.wait(0.5)
            pcall(function()
                RS.Remotes.CommF_:InvokeServer("StartQuest", boss.Quest, boss.ID)
            end)

            local bm = WaitEnemy(boss.Boss)
            if bm then
                TweenTo(bm.HumanoidRootPart.CFrame * CFrame.new(0,0,6))
                EquipWeapon()
                repeat
                    Click()
                    task.wait()
                until bm.Humanoid.Health <= 0 or not State.AutoFarm
            end
        else
            -- FARM NPC THÆ¯á»œNG
            local q = GetQuest()
            if not q then task.wait(1) continue end

            TweenTo(q.NPC)
            task.wait(0.4)
            pcall(function()
                RS.Remotes.CommF_:InvokeServer("StartQuest", q.Quest, q.ID)
            end)

            while State.AutoFarm do
                local mob = WaitEnemy(q.Mob)
                if mob then
                    TweenTo(mob.HumanoidRootPart.CFrame * CFrame.new(0,0,6))
                    EquipWeapon()
                    repeat
                        Click()
                        task.wait()
                    until mob.Humanoid.Health <= 0 or not State.AutoFarm
                end
                task.wait(0.2)
            end
        end
    end
end)

--================ AIMBOT =================
local function GetClosestEnemy()
    local closest, dist = nil, math.huge
    for _,m in pairs(workspace.Enemies:GetChildren()) do
        if m:FindFirstChild("HumanoidRootPart")
        and m:FindFirstChild("Humanoid")
        and m.Humanoid.Health > 0 then
            local pos, onScreen = Cam:WorldToViewportPoint(m.HumanoidRootPart.Position)
            if onScreen then
                local mag = (Vector2.new(pos.X,pos.Y)
                - Vector2.new(Cam.ViewportSize.X/2,Cam.ViewportSize.Y/2)).Magnitude
                if mag < dist and mag < State.FOV then
                    dist = mag
                    closest = m
                end
            end
        end
    end
    return closest
end

RunService.RenderStepped:Connect(function()
    if State.Aimbot then
        local t = GetClosestEnemy()
        if t then
            Cam.CFrame = CFrame.new(Cam.CFrame.Position, t.HumanoidRootPart.Position)
        end
    end
end)

--================ RAYFIELD UI =================
local FarmTab = Window:CreateTab("âš›ï¸ Auto Farm")
local AimTab = Window:CreateTab("ðŸŽ¯ Aimbot")
local MiscTab = Window:CreateTab("ðŸ›  Misc")

FarmTab:CreateToggle({
    Name = "Enable Auto Farm (Boss > NPC)",
    CurrentValue = false,
    Callback = function(v)
        State.AutoFarm = v
    end
})

FarmTab:CreateSlider({
    Name = "Fly Speed",
    Range = {150,500},
    Increment = 10,
    CurrentValue = 320,
    Callback = function(v)
        State.FlySpeed = v
    end
})

AimTab:CreateToggle({
    Name = "Enable Aimbot",
    CurrentValue = false,
    Callback = function(v)
        State.Aimbot = v
    end
})

AimTab:CreateSlider({
    Name = "Aimbot FOV",
    Range = {100,600},
    Increment = 25,
    CurrentValue = 250,
    Callback = function(v)
        State.FOV = v
    end
})

MiscTab:CreateButton({
    Name = "Reset Character",
    Callback = function()
        Hum.Health = 0
    end
})

MiscTab:CreateParagraph({
    Title = "Titan Tivi Man Hub",
    Content = "FINAL | Rayfield Only\nBoss Priority + Auto Quest + Aimbot\nðŸ’€ DÃ¡n lÃ  cháº¡y"
})
