--================ LOAD RAYFIELD =================
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "ðŸ“º Titan Tivi Man Hub | Blox Fruits",
    LoadingTitle = "Titan Tivi Man Hub",
    LoadingSubtitle = "Rayfield Edition",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "TitanTiviMan",
        FileName = "BloxFruits"
    },
    KeySystem = false
})

--================ SERVICES =================
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")

local LP = Players.LocalPlayer

--================ STATES =================
local State = {
    AutoFarm = false,
    Aim = false
}

--================ UTILS =================
local function Char()
    return LP.Character or LP.CharacterAdded:Wait()
end

local function HRP()
    return Char():WaitForChild("HumanoidRootPart")
end

--================ NPC =================
local function GetNPC()
    local near, dist = nil, math.huge
    for _,v in pairs(workspace.Enemies:GetChildren()) do
        if v:FindFirstChild("Humanoid")
        and v.Humanoid.Health > 0
        and v:FindFirstChild("HumanoidRootPart") then
            local d = (v.HumanoidRootPart.Position - HRP().Position).Magnitude
            if d < dist then
                dist = d
                near = v
            end
        end
    end
    return near
end

--================ AIR COMBAT (FIX ALL) =================
local HEIGHT = 16
local DIST = 6

task.spawn(function()
    while task.wait(0.15) do
        if State.AutoFarm then
            local npc = GetNPC()
            if npc then
                local nhrp = npc.HumanoidRootPart
                local hrp = HRP()

                -- Ã‰P BAY TRÃŠN CAO
                hrp.Velocity = Vector3.zero
                hrp.CFrame =
                    nhrp.CFrame
                    * CFrame.new(0, HEIGHT, DIST)
                    * CFrame.Angles(math.rad(-90), 0, 0)

                -- Ã‰P NPC Äá»¨NG YÃŠN
                nhrp.Velocity = Vector3.zero

                -- ÄÃNH LIÃŠN Tá»¤C
                VirtualUser:Button1Down(Vector2.new(0,0))
                task.wait(0.05)
                VirtualUser:Button1Up(Vector2.new(0,0))
            end
        end
    end
end)

--================ AIM =================
RunService.RenderStepped:Connect(function()
    if State.Aim then
        local npc = GetNPC()
        if npc and npc:FindFirstChild("Head") then
            workspace.CurrentCamera.CFrame =
                CFrame.new(
                    workspace.CurrentCamera.CFrame.Position,
                    npc.Head.Position
                )
        end
    end
end)

--================ RAYFIELD TABS =================
local StartTab = Window:CreateTab("ðŸš€ Start", 4483362458)
local FarmTab  = Window:CreateTab("âš›ï¸ Auto Farm", 4483362458)
local AimTab   = Window:CreateTab("ðŸŽ¯ Aim", 4483362458)

--================ START =================
StartTab:CreateButton({
    Name = "START ALL (AIR FARM)",
    Callback = function()
        State.AutoFarm = true
        State.Aim = true
        Rayfield:Notify({
            Title = "Titan Tivi Man Hub",
            Content = "ÄÃNH 100% TRÃŠN KHÃ”NG\nKhÃ´ng cháº¡m Ä‘áº¥t",
            Duration = 4
        })
    end
})

StartTab:CreateButton({
    Name = "STOP ALL",
    Callback = function()
        State.AutoFarm = false
        State.Aim = false
    end
})

--================ TOGGLES =================
FarmTab:CreateToggle({
    Name = "Auto Farm (Air)",
    CurrentValue = false,
    Callback = function(v)
        State.AutoFarm = v
    end
})

AimTab:CreateToggle({
    Name = "Aimbot NPC",
    CurrentValue = false,
    Callback = function(v)
        State.Aim = v
    end
})

Rayfield:Notify({
    Title = "Titan Tivi Man Hub",
    Content = "Loaded | Rayfield Air Combat",
    Duration = 3
})
