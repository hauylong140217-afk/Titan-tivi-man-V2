--====================================================
-- ðŸ“º TITAN TIVI MAN HUB | BLOX FRUITS | FINAL FIX
--====================================================

--========== LOAD RAYFIELD ==========
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
    Name = "ðŸ“º Titan Tivi Man Hub | FINAL FIX",
    LoadingTitle = "Titan Tivi Man Hub",
    LoadingSubtitle = "Quest â€¢ Skill â€¢ Boss â€¢ Raid",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "TitanTiviMan",
        FileName = "FinalFix"
    },
    KeySystem = false
})

--========== SERVICES ==========
local Players = game:GetService("Players")
local RS = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local VirtualInput = game:GetService("VirtualInputManager")
local LP = Players.LocalPlayer
local CommF = RS.Remotes.CommF_

--========== STATE ==========
local State = {
    AutoFarm = false,
    UseSkill = false,
    Aim = false,
    BossPriority = true,
    AutoRaid = false,
    AutoAwaken = false,
    SoloRaid = false
}

--========== RAID CONFIG ==========
local RaidConfig = {
    Method = "Fruit",
    Raid = "Flame"
}

local RaidList = {
    "Flame","Ice","Light","Magma","Dark","Sand","Buddha","Quake","Rumble"
}

--========== UTILS ==========
local function Char()
    return LP.Character or LP.CharacterAdded:Wait()
end
local function HRP()
    return Char():WaitForChild("HumanoidRootPart")
end

--========== QUEST FIX ==========
local function HasQuest()
    local gui = LP.PlayerGui:FindFirstChild("Main")
    return gui and gui:FindFirstChild("Quest") and gui.Quest.Visible
end

task.spawn(function()
    while task.wait(1) do
        if State.AutoFarm and not HasQuest() then
            pcall(function()
                CommF:InvokeServer("StartQuest","BanditQuest1",1)
            end)
        end
    end
end)

--========== TARGET ==========
local function GetBoss()
    for _,v in pairs(workspace.Enemies:GetChildren()) do
        if v:FindFirstChild("Humanoid")
        and v.Humanoid.Health > 0
        and v.Name:lower():find("boss") then
            return v
        end
    end
end

local function GetNPC()
    local best, dist = nil, math.huge
    for _,v in pairs(workspace.Enemies:GetChildren()) do
        if v:FindFirstChild("Humanoid")
        and v.Humanoid.Health > 0
        and v:FindFirstChild("HumanoidRootPart")
        and not v.Name:lower():find("boss") then
            local d = (v.HumanoidRootPart.Position - HRP().Position).Magnitude
            if d < dist then
                dist = d
                best = v
            end
        end
    end
    return best
end

local function GetTarget()
    if State.BossPriority then
        local b = GetBoss()
        if b then return b end
    end
    return GetNPC()
end

--========== AIR FARM ==========
task.spawn(function()
    while task.wait(0.12) do
        if State.AutoFarm then
            local t = GetTarget()
            if t and t:FindFirstChild("HumanoidRootPart") then
                HRP().AssemblyLinearVelocity = Vector3.zero
                HRP().CFrame =
                    t.HumanoidRootPart.CFrame
                    * CFrame.new(0,25,6)
                    * CFrame.Angles(math.rad(-90),0,0)
            end
        end
    end
end)

--========== AUTO SKILL SMART ==========
local SkillKeys = {
    Enum.KeyCode.Z,
    Enum.KeyCode.X,
    Enum.KeyCode.C,
    Enum.KeyCode.V,
    Enum.KeyCode.F
}
local SkillIndex = 1

task.spawn(function()
    while task.wait(0.45) do
        if State.UseSkill then
            local key = SkillKeys[SkillIndex]
            SkillIndex = SkillIndex % #SkillKeys + 1
            VirtualInput:SendKeyEvent(true, key, false, game)
            task.wait(0.05)
            VirtualInput:SendKeyEvent(false, key, false, game)
        end
    end
end)

--========== AIM ==========
RunService.RenderStepped:Connect(function()
    if State.Aim then
        local t = GetTarget()
        if t and t:FindFirstChild("Head") then
            workspace.CurrentCamera.CFrame =
                CFrame.new(workspace.CurrentCamera.CFrame.Position, t.Head.Position)
        end
    end
end)

--========== AUTO RAID ==========
task.spawn(function()
    while task.wait(2) do
        if State.AutoRaid then
            pcall(function()
                CommF:InvokeServer("RaidsNpc","Select",RaidConfig.Raid)
                CommF:InvokeServer("RaidsNpc","Start",RaidConfig.Method)
            end)
        end
    end
end)

--========== AUTO AWAKEN ==========
task.spawn(function()
    while task.wait(3) do
        if State.AutoAwaken then
            pcall(function()
                CommF:InvokeServer("Awakener","Awaken")
            end)
        end
    end
end)

--========== SOLO RAID SAFE ==========
task.spawn(function()
    while task.wait(0.5) do
        if State.SoloRaid then
            local hum = Char():FindFirstChild("Humanoid")
            if hum and hum.Health < hum.MaxHealth * 0.4 then
                HRP().CFrame = HRP().CFrame + Vector3.new(0,60,0)
            end
        end
    end
end)

--========== UI ==========
local StartTab  = Window:CreateTab("ðŸš€ Start")
local FarmTab   = Window:CreateTab("âš›ï¸ Farm")
local CombatTab = Window:CreateTab("âš”ï¸ Combat")
local RaidTab   = Window:CreateTab("ðŸ”¥ Raid")

StartTab:CreateButton({
    Name = "START ALL",
    Callback = function()
        for k in pairs(State) do State[k] = true end
        Rayfield:Notify({
            Title = "Titan Tivi Man Hub",
            Content = "ALL ENABLED",
            Duration = 3
        })
    end
})

StartTab:CreateButton({
    Name = "ðŸ›‘ STOP ALL",
    Callback = function()
        for k in pairs(State) do State[k] = false end
        Rayfield:Notify({
            Title = "Titan Tivi Man Hub",
            Content = "ALL STOPPED",
            Duration = 3
        })
    end
})

FarmTab:CreateToggle({
    Name = "Auto Farm (Air)",
    CurrentValue = false,
    Callback = function(v) State.AutoFarm = v end
})

CombatTab:CreateToggle({
    Name = "Auto Skill (Smart)",
    CurrentValue = false,
    Callback = function(v) State.UseSkill = v end
})

CombatTab:CreateToggle({
    Name = "Aim Lock",
    CurrentValue = false,
    Callback = function(v) State.Aim = v end
})

RaidTab:CreateToggle({
    Name = "Auto Raid",
    CurrentValue = false,
    Callback = function(v) State.AutoRaid = v end
})

RaidTab:CreateDropdown({
    Name = "Chá»n Raid",
    Options = RaidList,
    CurrentOption = "Flame",
    Callback = function(v) RaidConfig.Raid = v end
})

RaidTab:CreateDropdown({
    Name = "Má»Ÿ Raid báº±ng",
    Options = {"Fruit","Money"},
    CurrentOption = "Fruit",
    Callback = function(v) RaidConfig.Method = v end
})

RaidTab:CreateToggle({
    Name = "Auto Awaken",
    CurrentValue = false,
    Callback = function(v) State.AutoAwaken = v end
})

RaidTab:CreateToggle({
    Name = "Solo Raid (An toÃ n)",
    CurrentValue = false,
    Callback = function(v) State.SoloRaid = v end
})

Rayfield:Notify({
    Title = "Titan Tivi Man Hub",
    Content = "Loaded â€¢ FINAL FIX",
    Duration = 3
})
